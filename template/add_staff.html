<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Staff | AKG Charitable Society</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="card shadow-lg">
            <div class="card-header bg-success text-white">
                <h3 class="mb-0"><i class="fas fa-user-plus me-2"></i>Add New Staff</h3>
            </div>
            <div class="card-body">
                {% if error_message %}
                <div class="alert alert-danger d-flex align-items-center">
                    <i class="fas fa-exclamation-triangle me-3"></i>
                    <div>{{ error_message }}</div>
                </div>
                {% endif %}
                <form id="staffForm" method="POST" class="row g-4">
                    {% csrf_token %}
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="fullname" name="fullname"
                                   placeholder="Full Name" required pattern="^[A-Za-z\s]+$" minlength="3"
                                   title="Only letters and spaces allowed, at least 3 characters">
                            <label for="fullname"><i class="fas fa-user me-2"></i>Full Name</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <select class="form-select" id="role" name="role" required>
                                <option value="">Select Role</option>
                                <option value="Manager">Manager</option>
                                <option value="Coordinator">Coordinator</option>
                            </select>
                            <label for="role"><i class="fas fa-briefcase me-2"></i>Role</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="email" class="form-control" id="email" name="email"
                                   placeholder="name@example.com" required>
                            <label for="email"><i class="fas fa-envelope me-2"></i>Email</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="tel" class="form-control" id="phone" name="phone"
                                   placeholder="1234567890" required pattern="^[6-9]\d{9}$" inputmode="numeric"
                                   title="Enter a 10-digit phone number starting with 6,7,8, or 9">
                            <label for="phone"><i class="fas fa-phone me-2"></i>Phone</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="date" class="form-control" id="dob" name="dob" required>
                            <label for="dob"><i class="fas fa-birthday-cake me-2"></i>Date of Birth</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <select class="form-select" id="gender" name="gender" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                            <label for="gender"><i class="fas fa-venus-mars me-2"></i>Gender</label>
                        </div>
                    </div>
                    <div class="col-12">
                        <h5 class="text-muted mb-4"><i class="fas fa-map-marker-alt me-2"></i>Address Details</h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="place" name="place"
                                           placeholder="City/Town" required pattern="^[A-Za-z\s]+$"
                                           title="Only letters and spaces allowed">
                                    <label for="place">City/Town</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="post" name="post"
                                           placeholder="Post Office" required pattern="^[A-Za-z\s]+$"
                                           title="Only letters and spaces allowed">
                                    <label for="post">Post Office</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="district" name="district"
                                           placeholder="District" required pattern="^[A-Za-z\s]+$"
                                           title="Only letters and spaces allowed">
                                    <label for="district">District</label>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="pin" name="pin"
                                           placeholder="PIN Code" required pattern="^6\d{5}$" inputmode="numeric"
                                           title="PIN must start with 6 and be 6 digits long">
                                    <label for="pin">PIN Code</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="date" class="form-control" id="join_date" name="join_date" required>
                            <label for="join_date"><i class="fas fa-calendar-check me-2"></i>Join Date</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <select class="form-select" id="status" name="status" required>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                            <label for="status"><i class="fas fa-toggle-on me-2"></i>Status</label>
                        </div>
                    </div>
                    <div class="col-12 text-end mt-4">
                        <a href="{% url 'manage_staff' %}" class="btn btn-outline-secondary me-3">
                            <i class="fas fa-arrow-left me-2"></i>Cancel
                        </a>
                        <button type="submit" class="btn btn-success px-4">
                            <i class="fas fa-save me-2"></i>Add Staff
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('staffForm');
        const dobInput = document.getElementById('dob');
        const joinInput = document.getElementById('join_date');
        const today = new Date();
        const todayStr = today.toISOString().split('T')[0];
        const eighteenYearsAgo = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
        const eighteenYearsAgoStr = eighteenYearsAgo.toISOString().split('T')[0];

        // DOB validation
        dobInput.addEventListener('change', () => {
          const dob = dobInput.value;
          if (dob > todayStr) {
            alert('DOB cannot be in the future'); dobInput.value = ''; dobInput.focus();
          } else if (dob > eighteenYearsAgoStr) {
            alert('Staff must be at least 18 years old'); dobInput.value = ''; dobInput.focus();
          }
        });
        // Join date validation: must be today or future
        joinInput.addEventListener('change', () => {
          if (joinInput.value < todayStr) {
            alert('Join date cannot be in the past'); joinInput.value = ''; joinInput.focus();
          }
        });

        form.addEventListener('submit', e => {
          const letters = /^[A-Za-z\s]+$/;
          const phoneRe = /^[6-9]\d{9}$/;
          const pinRe = /^6\d{5}$/;
          const v = {
            name: document.getElementById('fullname').value.trim(),
            role: document.getElementById('role').value,
            email: document.getElementById('email').value.trim(),
            phone: document.getElementById('phone').value.trim(),
            dob: dobInput.value,
            gender: document.getElementById('gender').value,
            place: document.getElementById('place').value.trim(),
            post: document.getElementById('post').value.trim(),
            district: document.getElementById('district').value.trim(),
            pin: document.getElementById('pin').value.trim(),
            join: joinInput.value,
            status: document.getElementById('status').value
          };
          if (v.name.length < 3)             { alert('Full Name: at least 3 chars'); e.preventDefault(); return; }
          if (!letters.test(v.name))         { alert('Full Name: only letters & spaces'); e.preventDefault(); return; }
          if (!v.role)                       { alert('Select a Role'); e.preventDefault(); return; }
          if (!v.email.includes('@') || !v.email.includes('.')) { alert('Enter valid Email'); e.preventDefault(); return; }
          if (!phoneRe.test(v.phone))        { alert('Phone: 10 digits starting 6-9'); e.preventDefault(); return; }
          if (!v.dob)                        { alert('Select DOB'); e.preventDefault(); return; }
          if (v.dob > todayStr)              { alert('DOB cannot be future'); e.preventDefault(); return; }
          if (v.dob > eighteenYearsAgoStr)   { alert('Must be 18+'); e.preventDefault(); return; }
          if (!v.gender)                     { alert('Select Gender'); e.preventDefault(); return; }
          if (!letters.test(v.place))        { alert('Place: only letters'); e.preventDefault(); return; }
          if (!letters.test(v.post))         { alert('Post: only letters'); e.preventDefault(); return; }
          if (!letters.test(v.district))     { alert('District: only letters'); e.preventDefault(); return; }
          if (!pinRe.test(v.pin))            { alert('PIN: start 6, 6 digits'); e.preventDefault(); return; }
          if (!v.join)                       { alert('Select Join Date'); e.preventDefault(); return; }
          if (v.join < todayStr)             { alert('Join date cannot be in the past'); e.preventDefault(); return; }
          if (!v.status)                     { alert('Select Status'); e.preventDefault(); return; }
        });
      });
    </script>
</body>
</html>
