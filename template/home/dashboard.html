{% extends 'base.html' %}

{% block content %}
<style>
  /* Dashboard Section Card Style */
  .dashboard-section {
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      padding: 2rem;
      margin-bottom: 2rem;
  }
  .dashboard-section h3 {
      border-bottom: 2px solid var(--secondary-color);
      padding-bottom: 0.5rem;
      margin-bottom: 1.5rem;
      color: var(--primary-color);
  }
  .table-dashboard th, .table-dashboard td {
      vertical-align: middle;
  }
  .empty-message {
      text-align: center;
      color: #888;
      padding: 1rem;
  }
  /* Badge Styling for Beneficiary Request Status */
  .badge-pending {
      background-color: #ffc107;
      color: #212529;
  }
  .badge-resolved {
      background-color: #28a745;
      color: #fff;
  }
</style>

<div class="container my-5">
  <h1 class="mb-4 text-center">My Account Dashboard</h1>
  
  <!-- Donations Section -->
  <section class="dashboard-section">
    <h3>My Donations</h3>
    {% if donations %}
      <div class="table-responsive">
        <table class="table table-striped table-hover table-dashboard">
          <thead class="table-dark">
            <tr>
              <th>Date</th>
              <th>Amount</th>
              <th>Type</th>
            </tr>
          </thead>
          <tbody>
            {% for donation in donations %}
            <tr>
              <td>{{ donation.date_time|date:"F j, Y" }}</td>
              <td>${{ donation.amount }}</td>
              <td>{{ donation.donation_type }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="empty-message">You haven't made any donations yet.</div>
    {% endif %}
  </section>

  <!-- Beneficiary Requests Section -->
  <section class="dashboard-section">
    <h3>My Beneficiary Requests</h3>
    {% if beneficiary_requests %}
      <div class="table-responsive">
        <table class="table table-striped table-hover table-dashboard">
          <thead class="table-dark">
            <tr>
              <th>Date</th>
              <th>Emergency Type</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {% for req in beneficiary_requests %}
            <tr>
              <td>{{ req.date|date:"F j, Y" }}</td>
              <td>{{ req.emergency_type }}</td>
              <td>
                {% if req.status == "Pending" %}
                  <span class="badge badge-pending">Pending</span>
                {% else %}
                  <span class="badge badge-resolved">Resolved</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="empty-message">You haven't submitted any beneficiary requests yet.</div>
    {% endif %}
  </section>

  <!-- Feedback Section -->
  <section class="dashboard-section">
    <h3>My Feedback</h3>
    {% if feedbacks %}
      <div class="table-responsive">
        <table class="table table-striped table-hover table-dashboard">
          <thead class="table-dark">
            <tr>
              <th>Date</th>
              <th>Rating</th>
              <th>Comments</th>
              <th>Admin Reply</th>
            </tr>
          </thead>
          <tbody>
            {% for fb in feedbacks %}
            <tr>
              <td>{{ fb.date|date:"F j, Y" }}</td>
              <td>
                {% for star in "12345"|make_list %}
                  {% if forloop.counter <= fb.rating %}
                    <i class="fas fa-star text-warning"></i>
                  {% else %}
                    <i class="far fa-star text-warning"></i>
                  {% endif %}
                {% endfor %}
              </td>
              <td>{{ fb.comments }}</td>
              <td>{{ fb.reply|default:"No reply yet" }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="empty-message">You haven't provided any feedback yet.</div>
    {% endif %}
  </section>
</div>
{% endblock %}
