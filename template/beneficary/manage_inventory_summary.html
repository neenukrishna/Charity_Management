{% extends 'base.html' %}
{% block content %}
<div class="container mt-5">
    <h3 class="text-primary mb-3">Money-based Donation Totals by Category</h3>
    <table class="table table-bordered mb-4">
        <thead>
            <tr>
                <th>Donation Category</th>
                <th>Total Amount (₹)</th>
                <th>Allocated Amount (₹)</th>
                <th>Available Amount (₹)</th>
                <th># of Entries</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for key, summary in money_summary.items %}
            <tr>
                <td>{{ summary.donation_type_display }}</td>
                <td>₹{{ summary.total_amount|default:"0" }}</td>
                <td>₹{{ summary.allocated_amount|default:"0" }}</td>
                <td>₹{{ summary.available_amount|default:"0" }}</td>
                <td>{{ summary.entries_count }}</td>
                <td>
                    {% if key %}
                        <a href="{% url 'allocate_by_category' key %}" class="btn btn-sm btn-warning">
                            Allocate Now
                        </a>
                    {% else %}
                        <span class="text-muted">No category specified</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <h3 class="text-primary mb-3">Other Donations (In-Kind) by Sub-Category</h3>
    <table class="table table-bordered mb-4">
        <thead>
            <tr>
                <th>Sub-Category</th>
                <th>Total Quantity</th>
                <th>Allocated Quantity</th>
                <th>Available Quantity</th>
                <th># of Entries</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in others_summary %}
            <tr>
                <td>{{ entry.sub_category }}</td>
                <td>{{ entry.total_quantity|default:"0" }}</td>
                <td>{{ entry.allocated_quantity|default:"0" }}</td>
                <td>{{ entry.available_quantity|default:"0" }}</td>
                <td>{{ entry.entries_count }}</td>
                <td>
                    {% if entry.sub_category %}
                        <a href="{% url 'allocate_by_category' entry.sub_category %}" class="btn btn-sm btn-warning">
                            Allocate Now
                        </a>
                    {% else %}
                        <span class="text-muted">No sub-category specified</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">No Other Donations found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- Optionally, include a detailed inventory listing below -->
    <h3 class="mt-5 text-primary">Detailed Inventory Listing</h3>
    <table class="table table-hover table-striped">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Donation</th>
                <th>Item Name</th>
                <th>Quantity</th>
                <th>Allocated</th>
                <th>Allocated To</th>
                <th>Date Received</th>
            </tr>
        </thead>
        <tbody>
            {% for item in inventory_items %}
            <tr>
                <td>{{ item.id }}</td>
                <td>{{ item.donation }}</td>
                <td>{{ item.item_name }}</td>
                <td>{{ item.quantity }}</td>
                <td>{% if item.allocated %}Yes{% else %}No{% endif %}</td>
                <td>{% if item.allocated_to %}{{ item.allocated_to.beneficiary_name }}{% else %}Not Allocated{% endif %}</td>
                <td>{{ item.date_received|date:"M d, Y H:i" }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center">No inventory items found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
